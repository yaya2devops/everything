{"version":3,"file":"clean-basic-html.js","sources":["../lib/clean-basic-html.js"],"sourcesContent":["/**\n * Removes any <code> wrappers around replacement strings {foo}\n * Example input:  <code><span>{foo}</span></code>\n * Example output:       <span>{foo}</span>\n * @param {string} html\n * @returns {string}\n */\nfunction removeCodeWrappers(html) {\n    return html.replace(/<code\\b[^>]*>((.*?){.*?}(.*?))<\\/code>/gi, '$1');\n}\n\n/**\n * Parses an html string and returns a cleaned version\n * @param {string} html\n * @param {Object} _options\n * @param {boolean} [_options.allowBr] - if true, <br> tags will be kept\n * @param {boolean} [_options.firstChildInnerContent] - if true, only the innerHTML of the first element will be returned\n * @param {boolean} [_options.removeCodeWrappers] - if true, <code> wrappers around replacement strings {foo} will be removed\n * @returns {string}\n */\nexport default function cleanBasicHtml(html = '', _options = {}) {\n    const defaults = {};\n    const options = Object.assign({}, defaults, _options);\n\n    if (!options.createDocument) {\n        const Parser = (typeof DOMParser !== 'undefined' && DOMParser) || (typeof window !== 'undefined' && window.DOMParser);\n\n        if (!Parser) {\n            // eslint-disable-next-line ghost/ghost-custom/no-native-error\n            throw new Error('cleanBasicHtml() must be passed a `createDocument` function as an option when used in a non-browser environment');\n        }\n\n        options.createDocument = function (docHtml) {\n            const parser = new Parser();\n            return parser.parseFromString(docHtml, 'text/html');\n        };\n    }\n\n    let cleanHtml = html;\n\n    if (!options.allowBr || cleanHtml === '<br>') {\n        cleanHtml = cleanHtml\n            .replace(/<br\\s?\\/?>/g, ' ');\n    }\n\n    if (options.removeCodeWrappers) {\n        cleanHtml = removeCodeWrappers(cleanHtml);\n    }\n\n    cleanHtml = cleanHtml\n        .replace(/(\\s|&nbsp;){2,}/g, ' ')\n        .trim()\n        .replace(/^&nbsp;|&nbsp$/g, '')\n        .trim();\n\n    // remove any elements that have a blank textContent\n    if (cleanHtml) {\n        let doc = options.createDocument(cleanHtml);\n\n        // don't analyze the document if it's empty (can result in storing <br> tags if allowed)\n        if (doc.body.textContent === '') {\n            return null;\n        }\n\n        doc.body.querySelectorAll('*').forEach((element) => {\n            // Treat Zero Width Non-Joiner characters as spaces\n            if (!element.textContent.trim().replace(/\\u200c+/g, '')) {\n                if (options.allowBr && element.tagName === 'BR') {\n                    // keep it\n                    return;\n                }\n                if (options.allowBr && element.querySelector('br')) {\n                    return element.replaceWith(doc.createElement('br'));\n                }\n                if (element.textContent.length > 0) {\n                    // keep a single space to avoid collapsing spaces\n                    let space = doc.createTextNode(' ');\n                    return element.replaceWith(space);\n                }\n                return element.remove();\n            }\n        });\n\n        if (options.firstChildInnerContent && doc.body.firstElementChild) {\n            cleanHtml = doc.body.firstElementChild.innerHTML.trim();\n        } else {\n            cleanHtml = doc.body.innerHTML.trim();\n        }\n    }\n\n    return cleanHtml;\n}\n"],"names":["removeCodeWrappers","html","replace","cleanBasicHtml","_options","defaults","options","Object","assign","createDocument","Parser","DOMParser","window","Error","docHtml","parser","parseFromString","cleanHtml","allowBr","trim","doc","body","textContent","querySelectorAll","forEach","element","tagName","querySelector","replaceWith","createElement","length","space","createTextNode","remove","firstChildInnerContent","firstElementChild","innerHTML"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,kBAAkBA,CAACC,IAAI,EAAE;AAC9B,EAAA,OAAOA,IAAI,CAACC,OAAO,CAAC,0CAA0C,EAAE,IAAI,CAAC,CAAA;AACzE,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASC,cAAcA,CAACF,IAAI,GAAG,EAAE,EAAEG,QAAQ,GAAG,EAAE,EAAE;EAC7D,MAAMC,QAAQ,GAAG,EAAE,CAAA;AACnB,EAAA,MAAMC,OAAO,GAAGC,MAAM,CAACC,MAAM,CAAC,EAAE,EAAEH,QAAQ,EAAED,QAAQ,CAAC,CAAA;AAErD,EAAA,IAAI,CAACE,OAAO,CAACG,cAAc,EAAE;AACzB,IAAA,MAAMC,MAAM,GAAI,OAAOC,SAAS,KAAK,WAAW,IAAIA,SAAS,IAAM,OAAOC,MAAM,KAAK,WAAW,IAAIA,MAAM,CAACD,SAAU,CAAA;IAErH,IAAI,CAACD,MAAM,EAAE;AACT;AACA,MAAA,MAAM,IAAIG,KAAK,CAAC,iHAAiH,CAAC,CAAA;AACtI,KAAA;AAEAP,IAAAA,OAAO,CAACG,cAAc,GAAG,UAAUK,OAAO,EAAE;AACxC,MAAA,MAAMC,MAAM,GAAG,IAAIL,MAAM,EAAE,CAAA;AAC3B,MAAA,OAAOK,MAAM,CAACC,eAAe,CAACF,OAAO,EAAE,WAAW,CAAC,CAAA;KACtD,CAAA;AACL,GAAA;EAEA,IAAIG,SAAS,GAAGhB,IAAI,CAAA;EAEpB,IAAI,CAACK,OAAO,CAACY,OAAO,IAAID,SAAS,KAAK,MAAM,EAAE;IAC1CA,SAAS,GAAGA,SAAS,CAChBf,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC,CAAA;AACpC,GAAA;EAEA,IAAII,OAAO,CAACN,kBAAkB,EAAE;AAC5BiB,IAAAA,SAAS,GAAGjB,kBAAkB,CAACiB,SAAS,CAAC,CAAA;AAC7C,GAAA;EAEAA,SAAS,GAAGA,SAAS,CAChBf,OAAO,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAChCiB,IAAI,EAAE,CACNjB,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAC9BiB,IAAI,EAAE,CAAA;;AAEX;AACA,EAAA,IAAIF,SAAS,EAAE;AACX,IAAA,IAAIG,GAAG,GAAGd,OAAO,CAACG,cAAc,CAACQ,SAAS,CAAC,CAAA;;AAE3C;AACA,IAAA,IAAIG,GAAG,CAACC,IAAI,CAACC,WAAW,KAAK,EAAE,EAAE;AAC7B,MAAA,OAAO,IAAI,CAAA;AACf,KAAA;IAEAF,GAAG,CAACC,IAAI,CAACE,gBAAgB,CAAC,GAAG,CAAC,CAACC,OAAO,CAAEC,OAAO,IAAK;AAChD;AACA,MAAA,IAAI,CAACA,OAAO,CAACH,WAAW,CAACH,IAAI,EAAE,CAACjB,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,EAAE;QACrD,IAAII,OAAO,CAACY,OAAO,IAAIO,OAAO,CAACC,OAAO,KAAK,IAAI,EAAE;AAC7C;AACA,UAAA,OAAA;AACJ,SAAA;QACA,IAAIpB,OAAO,CAACY,OAAO,IAAIO,OAAO,CAACE,aAAa,CAAC,IAAI,CAAC,EAAE;UAChD,OAAOF,OAAO,CAACG,WAAW,CAACR,GAAG,CAACS,aAAa,CAAC,IAAI,CAAC,CAAC,CAAA;AACvD,SAAA;AACA,QAAA,IAAIJ,OAAO,CAACH,WAAW,CAACQ,MAAM,GAAG,CAAC,EAAE;AAChC;AACA,UAAA,IAAIC,KAAK,GAAGX,GAAG,CAACY,cAAc,CAAC,GAAG,CAAC,CAAA;AACnC,UAAA,OAAOP,OAAO,CAACG,WAAW,CAACG,KAAK,CAAC,CAAA;AACrC,SAAA;AACA,QAAA,OAAON,OAAO,CAACQ,MAAM,EAAE,CAAA;AAC3B,OAAA;AACJ,KAAC,CAAC,CAAA;IAEF,IAAI3B,OAAO,CAAC4B,sBAAsB,IAAId,GAAG,CAACC,IAAI,CAACc,iBAAiB,EAAE;MAC9DlB,SAAS,GAAGG,GAAG,CAACC,IAAI,CAACc,iBAAiB,CAACC,SAAS,CAACjB,IAAI,EAAE,CAAA;AAC3D,KAAC,MAAM;MACHF,SAAS,GAAGG,GAAG,CAACC,IAAI,CAACe,SAAS,CAACjB,IAAI,EAAE,CAAA;AACzC,KAAA;AACJ,GAAA;AAEA,EAAA,OAAOF,SAAS,CAAA;AACpB;;;;"}